# Система управления компаниями

Веб-приложение для управления данными компаний с использованием IndexedDB и Observer Pattern. Приложение обеспечивает полный CRUD функционал с пагинацией, фильтрацией и сортировкой данных.

## Технологический стек

- **TypeScript** - типизированная разработка
- **Vite** - сборка и инструменты разработки
- **IndexedDB** - локальное хранение данных в браузере
- **Observer Pattern** - автоматическое обновление UI при изменении данных
- **Vanilla JavaScript** - без внешних фреймворков

## Основной функционал

- ✅ Добавление новых компаний
- ✅ Редактирование существующих компаний
- ✅ Удаление компаний
- ✅ Пагинация данных (5 записей на страницу)
- ✅ Фильтрация по ФИО директора
- ✅ Сортировка по названию компании и ФИО директора
- ✅ Валидация форм
- ✅ Автоматическое обновление таблицы через Observer Pattern
- ✅ Тестовые данные для демонстрации

## Требования к браузеру

- Поддержка IndexedDB (Chrome 24+, Firefox 16+, Safari 10+, Edge 12+)
- Поддержка ES6 модулей
- Поддержка TypeScript (через Vite)

## Установка и запуск

### Установка зависимостей

```bash
npm install
```

### Режим разработки

```bash
npm run dev
```

Приложение будет доступно по адресу `http://localhost:3000`

### Сборка для продакшена

```bash
npm run build
```

Собранные файлы будут находиться в папке `dist/`

### Предварительный просмотр сборки

```bash
npm run preview
```

### Дополнительные команды

```bash
npm run lint          # Проверка кода линтером
npm run lint:fix       # Автоматическое исправление ошибок линтера
npm run format         # Форматирование кода
npm run format:check   # Проверка форматирования
npm run type-check     # Проверка типов TypeScript
```

## Структура проекта

```
src/
├── types/
│   ├── Company.ts          # Интерфейсы для данных компаний
│   └── Observer.ts         # Типы для Observer Pattern
├── database/
│   └── CompanyDatabase.ts  # Работа с IndexedDB и Observer
├── ui/
│   ├── TableManager.ts     # Управление таблицей и пагинацией
│   └── FormHandler.ts      # Обработка форм и модальных окон
├── utils/
│   └── testData.ts         # Генерация тестовых данных
├── styles/
│   └── main.css           # Стили приложения
├── App.ts                 # Главный класс приложения
└── main.ts               # Точка входа приложения
```

## Архитектура и описание классов

### App (src/App.ts)

Главный класс приложения, координирует работу всех компонентов и управляет состоянием.

**Методы:**

- `constructor()` - инициализация компонентов и подписка на изменения базы данных
- `setupDatabaseSubscription()` - подписка на изменения в базе данных
- `parseUrlParams()` - парсинг URL параметров для навигации
- `resetFiltersAndSorting()` - сброс фильтров и сортировки
- `updateUrl(page)` - обновление URL при смене страницы
- `loadPage()` - загрузка данных для текущей страницы
- `handlePageChange(page)` - обработка смены страницы
- `initialize()` - инициализация приложения
- `setupFilterInput()` - настройка обработчика фильтрации
- `handleSort(field)` - обработка сортировки по полю
- `getSortState()` - получение текущего состояния сортировки

### CompanyDatabase (src/database/CompanyDatabase.ts)

Класс для работы с IndexedDB и реализации Observer Pattern.

**Методы:**

- `constructor()` - инициализация базы данных
- `initDB()` - создание и настройка IndexedDB
- `subscribe(observer)` - подписка на изменения данных
- `notifyObservers(companies)` - уведомление всех подписчиков
- `addCompany(company)` - добавление новой компании
- `updateCompany(company)` - обновление существующей компании
- `deleteCompany(id)` - удаление компании по ID
- `loadAllCompanies()` - загрузка всех компаний из базы
- `loadAllCompaniesToCache()` - загрузка данных в кэш
- `getCompaniesPage(page, pageSize, filterQuery, sortField, sortDirection)` - получение пагинированных данных с фильтрацией и сортировкой
- `invalidateCache()` - очистка кэша
- `getCompanyById(id)` - получение компании по ID

### FormHandler (src/ui/FormHandler.ts)

Класс для обработки форм и управления модальными окнами.

**Методы:**

- `constructor(database)` - инициализация обработчика форм
- `initializeEventListeners()` - настройка обработчиков событий
- `setupValidation()` - настройка валидации формы
- `handleSubmit()` - обработка отправки формы
- `validateData(data)` - валидация данных формы
- `loadCompanyForEdit(company)` - загрузка данных компании для редактирования
- `clearForm()` - очистка формы
- `openModal()` - открытие модального окна
- `closeModal()` - закрытие модального окна

### TableManager (src/ui/TableManager.ts)

Класс для управления таблицей, пагинацией и сортировкой.

**Методы:**

- `constructor(database, app)` - инициализация менеджера таблицы
- `formatAddress(address)` - форматирование адреса для отображения
- `renderTable(companies)` - отрисовка таблицы с данными
- `renderPagination(currentPage, totalPages)` - отрисовка пагинации
- `generatePageNumbers(currentPage, totalPages)` - генерация номеров страниц
- `setupPaginationHandlers()` - настройка обработчиков пагинации
- `setupHeaderClickHandlers()` - настройка обработчиков кликов по заголовкам
- `updateSortIndicators()` - обновление индикаторов сортировки
- `attachEventListeners()` - привязка обработчиков событий к элементам таблицы
- `deleteCompany(id)` - удаление компании
- `editCompany(id)` - редактирование компании

### Типы данных

#### Company (src/types/Company.ts)

- `Address` - интерфейс для адреса компании
- `Company` - основная модель компании
- `CompanyFormData` - данные формы для создания/редактирования компании

#### Observer (src/types/Observer.ts)

- `Observer<T>` - тип функции-наблюдателя
- `Unsubscribe` - тип функции отписки

### Утилиты

## IndexedDB как хранилище данных

Приложение использует IndexedDB для локального хранения данных компаний в браузере:

### Преимущества IndexedDB:

- **Локальное хранение** - данные сохраняются на устройстве пользователя
- **Большой объем** - может хранить значительно больше данных чем localStorage
- **Асинхронная работа** - не блокирует основной поток
- **Транзакции** - обеспечивает целостность данных
- **Индексы** - быстрый поиск по полям

### Структура базы данных:

- **Название БД**: `CompanyDB`
- **Версия**: 2
- **Store**: `companies`
- **Ключ**: `id` (автоинкремент)
- **Индексы**: `companyName`, `directorFullName`

### Особенности реализации:

- Автоматическое создание базы при первом запуске
- Кэширование данных для быстрого доступа
- Observer Pattern для автоматического обновления UI
- Транзакции для безопасных операций записи
